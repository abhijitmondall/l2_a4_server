// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

// Looking for ways to speed up your queries, or scale easily with your serverless or edge functions?
// Try Prisma Accelerate: https://pris.ly/cli/accelerate-init

generator client {
  provider = "prisma-client"
  output   = "../generated/prisma"
}

datasource db {
  provider = "postgresql"
}


////////////////////
/// ENUMS
////////////////////

enum Role {
  customer
  seller
  admin
}

enum UserStatus {
  active
  banned
}

enum OrderStatus {
  placed
  processing
  shipped
  delivered
  cancelled
}

enum PaymentMethod {
  COD
}

enum Gender {
  Male
  Female
  Other
}

////////////////////
/// USER
////////////////////

model User {
  id        String     @id @default(uuid())
  name      String
  email     String     @unique
  password  String
  role      Role @default(customer)
  status    UserStatus @default(active)
  photo String?
  phone     String?
  address   String?
  gender Gender?

  // Relations
  medicines   Medicine[]  @relation("SellerMedicines")
  orders      Order[]     @relation("CustomerOrders")
  orderItems  OrderItem[] @relation("SellerOrderItems")
  cart        Cart?
  reviews     Review[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}


////////////////////
/// CATEGORY
////////////////////

model Category {
  id        String     @id @default(uuid())
  name      String     @unique

  medicines Medicine[]

  createdAt DateTime   @default(now())
  updatedAt DateTime @updatedAt
}

////////////////////
/// MEDICINE
////////////////////

model Medicine {
  id            String   @id @default(uuid())
  name          String
  description   String
  price         Int
  stock         Int
  manufacturer  String
  image         String?

  // Relations
  categoryId    String
  category      Category @relation(fields: [categoryId], references: [id])

  sellerId      String
  seller        User     @relation("SellerMedicines", fields: [sellerId], references: [id])

  reviews       Review[]
  orderItems    OrderItem[]
  cartItems     CartItem[]

  createdAt     DateTime @default(now())
  updatedAt     DateTime @updatedAt

  @@index([categoryId])
  @@index([sellerId])
}

////////////////////
/// CART
////////////////////

model Cart {
  id        String     @id @default(uuid())
  userId    String     @unique
  user      User       @relation(fields: [userId], references: [id])

  items     CartItem[]

  createdAt DateTime   @default(now())
  updatedAt DateTime   @updatedAt
}

model CartItem {
  id          String   @id @default(uuid())
  cartId      String
  medicineId  String
  quantity    Int

  cart        Cart     @relation(fields: [cartId], references: [id])
  medicine    Medicine @relation(fields: [medicineId], references: [id])

  @@unique([cartId, medicineId])
}

////////////////////
/// ORDER
////////////////////

model Order {
  id            String        @id @default(uuid())
  customerId    String
  customer      User          @relation("CustomerOrders", fields: [customerId], references: [id])

  status        OrderStatus   @default(placed)
  paymentMethod PaymentMethod @default(COD)
  totalAmount   Int

  // Shipping
  shippingName  String
  shippingPhone String
  shippingAddr  String

  items         OrderItem[]

  createdAt     DateTime      @default(now())
  updatedAt     DateTime      @updatedAt

  @@index([customerId])
  @@index([status])
}

model OrderItem {
  id         String @id @default(uuid())
  orderId    String
  medicineId String
  sellerId   String
  quantity   Int
  price      Int

  order      Order    @relation(fields: [orderId], references: [id])
  medicine   Medicine @relation(fields: [medicineId], references: [id])

  seller     User     @relation("SellerOrderItems", fields: [sellerId], references: [id])

  @@index([sellerId])
}


////////////////////
/// REVIEW
////////////////////

model Review {
  id          String   @id @default(uuid())
  rating      Float
  comment     String

  medicineId  String
  medicine    Medicine @relation(fields: [medicineId], references: [id])

  userId      String
  user        User     @relation(fields: [userId], references: [id])

  createdAt   DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([medicineId, userId])
}